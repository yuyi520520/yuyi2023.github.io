import{r as O,a as v,f as a,o as p,b as g,e,w as l,d as i,t as H,H as U,I as ae,j as G,B as se,C as ee,i as ne,F as re}from"./index-accd95a7.js";/* empty css                       */const ce=i("div",{class:"card-header"},[i("span",null,"专题文章")],-1),ie={class:"custom-node-style"},ue={class:"node-title"},de={key:0,style:{color:"red","font-size":"13px"}},pe={key:1,style:{color:"green","font-size":"13px"}},_e=i("div",{class:"card-header"},[i("span",null,"文章详情")],-1),ge={key:0},ve={class:"my-title"},fe=["innerHTML"],me={key:1,class:"no-data"},ye={__name:"SubDetail",setup(Q,{expose:f}){const{proxy:h}=G(),b={getBlogDetail:"/blog/getBlogById",getSpecialInfo:"blog/getSpecialInfo"},I=O({show:!1,buttons:[{type:"danger",text:"确定",click:u=>{I.show=!1}}]}),x=v(null),y=v({}),q=async u=>{I.show=!0,x.value=u.blogId,R(u.categoryId),w(u.blogId)},w=async u=>{let m=await h.Request({url:b.getBlogDetail,params:{blogId:u}});m&&(y.value=m.data,U(()=>{document.querySelectorAll("pre code").forEach(S=>{ae.highlightBlock(S)})}))},B=u=>{if(u.blogId=="0"){y.value={};return}w(u.blogId)},d={children:"children",label:"title",value:"blogId"},_=v([]),D=v(null),R=async u=>{let m=await h.Request({url:b.getSpecialInfo,params:{categoryId:u,showType:"1"}});m&&(_.value=m.data,U(()=>{D.value.setCurrentKey(x.value)}))};return f({showDetail:q}),(u,m)=>{const s=a("el-tree"),S=a("el-card"),$=a("el-col"),k=a("el-row"),T=a("Window");return p(),g("div",null,[e(T,{show:I.show,buttons:I.buttons,showCancel:!1,onClose:m[0]||(m[0]=c=>I.show=!1)},{default:l(()=>[e(k,{gutter:10},{default:l(()=>[e($,{span:10},{default:l(()=>[e(S,{class:"box-card"},{header:l(()=>[ce]),default:l(()=>[e(s,{class:"tree-panel",ref_key:"refTree",ref:D,data:_.value,defaultExpandAll:"","node-key":"blogId","expand-on-click-node":!1,props:d,"highlight-current":!0,onNodeClick:B},{default:l(({data:c})=>[i("span",ie,[i("span",ue,[c.status==0?(p(),g("span",de,H(c.title),1)):(p(),g("span",pe,H(c.title),1))])])]),_:1},8,["data"])]),_:1})]),_:1}),e($,{span:14},{default:l(()=>[e(S,{class:"box-card"},{header:l(()=>[_e]),default:l(()=>[y.value.title?(p(),g("div",ge,[i("div",ve,H(y.value.title),1),i("div",{innerHTML:y.value.content,class:"blog-detail"},null,8,fe)])):(p(),g("div",me," 请选择专题文章，查看详情 "))]),_:1})]),_:1})]),_:1})]),_:1},8,["show","buttons"])])}}};const he={class:"title-input"},be={style:{width:"100%"}},we={__name:"SubEdit",setup(Q,{expose:f,emit:h}){const{proxy:b}=G(),I=window.innerHeight-60-20-30-50-10-50-10,x=window.innerHeight-60-20-30-50-100-50,y={saveBlog:"/blog/saveBlog4Special",getUserInfo:"getUserInfo",getBlogDetail:"/blog/getBlogById",autoSave:"/blog/autoSaveBlog4Special"};f({init:(c,n)=>{_(),u.show=!0,U(()=>{m.value.resetFields(),s.value={categoryId:n.categoryId,pBlogId:n.blogId},c==="add"?w():B(n.blogId)})}});const w=async()=>{let c=await b.Request({url:y.getUserInfo});c&&(s.value.editorType=c.data.editorType)},B=async c=>{let n=await b.Request({url:y.getBlogDetail,params:{blogId:c}});n&&(s.value=n.data,n.data.tag?s.value.tag=n.data.tag.split("|"):s.value.tag=[])};let d=v(null);const _=()=>{d.value=setInterval(()=>{R()},1e4)},D=()=>{d.value!==null&&(clearInterval(d.value),d.value=null)},R=async()=>{if(s.value.title==null||s.value.content==null||d.value==null)return;const c={};Object.assign(c,s.value);let n=await b.Request({url:y.autoSave,showLoading:!1,params:c});n&&(s.value.blogId=n.data)},u=O({show:!1,buttons:[{type:"danger",text:"确定",click:c=>{$()}}]}),m=v(null),s=v({tag:[]}),S=c=>{s.value.content=c},$=()=>{m.value.validate(async c=>{if(!c)return;let n=Object.assign({},s.value);await b.Request({url:y.saveBlog,params:n})&&(b.Message.success("保存博客成功"),k())})},k=()=>{u.show=!1,h("callback"),d.value!==null&&D()},T={title:[{required:!0,message:"请输入标题"}],content:[{required:!0,message:"请输入正文"}],categoryId:[{required:!0,message:"请选择博客分类"}],type:[{required:!0,message:"请选择博客类型"}],allowComment:[{required:!0,message:"请选择是否允许评论"}],reprintUrl:[{required:!0,message:"请输入原文地址"}]};return se(()=>{D()}),(c,n)=>{const N=a("el-input"),L=a("el-form-item"),z=a("EditorHtml"),F=a("EditorMarkdown"),W=a("el-form"),t=a("Window");return p(),g("div",null,[e(t,{show:u.show,buttons:u.buttons,onClose:k},{default:l(()=>[e(W,{model:s.value,rules:T,ref_key:"blogFormRef",ref:m},{default:l(()=>[e(L,{prop:"title"},{default:l(()=>[i("div",he,[e(N,{placeholder:"请输入博客标题",modelValue:s.value.title,"onUpdate:modelValue":n[0]||(n[0]=o=>s.value.title=o)},null,8,["modelValue"])])]),_:1}),e(L,{prop:"content"},{default:l(()=>[i("div",be,[s.value.editorType==0?(p(),ee(z,{key:0,height:x,modelValue:s.value.content,"onUpdate:modelValue":n[1]||(n[1]=o=>s.value.content=o)},null,8,["modelValue"])):(p(),ee(F,{key:1,height:I,modelValue:s.value.markdownContent,"onUpdate:modelValue":n[2]||(n[2]=o=>s.value.markdownContent=o),onHtmlContent:S},null,8,["modelValue"]))])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","buttons"])])}}};const ke=i("div",{class:"card-header"},[i("span",null,"专题")],-1),Ie={class:"op"},Ce=["onClick"],Se=["onClick"],xe=i("div",{class:"card-header"},[i("span",null,"专题文章")],-1),Be={style:{"margin-bottom":"5px"}},De={class:"custom-node-style"},Re={class:"node-title"},$e={key:0,style:{color:"red","font-size":"13px"}},Ve={key:1,style:{color:"green","font-size":"13px"}},qe={class:"node-op"},Te=["onClick"],je=["onClick"],Ee=["onClick"],He={key:1},Ue=["onClick"],Ne={key:3},Le=["onClick"],Oe={__name:"Subject",setup(Q){const{proxy:f}=G(),h={loadDataList:"/category/loadCategory4Special",saveCategory:"/category/saveCategory4Special",delCategory:"category/delCategory4Special",getSpecialInfo:"blog/getSpecialInfo",delBlog:"/blog/recoveryBlog",updateSpecialBlogSort:"blog/updateSpecialBlogSort"},b=v(f.VueCookies.get("userInfo")||{}),I=[{label:"封面",prop:"cover",width:100,scopedSlots:"cover"},{label:"名称",prop:"categoryName",width:200},{label:"简介",prop:"categoryDesc"},{label:"博客数量",prop:"blogCount",width:100},{label:"操作",prop:"op",width:100,scopedSlots:"op"}],x=O({}),y={extHeight:135},q=v(null),w=v(null),B=async()=>{let t=await f.Request({url:h.loadDataList});t&&(Object.assign(x,t.data),w.value==null&&t.data.list.length>0&&(w.value=t.data.list[0].categoryId,k()),U(()=>{q.value.setCurrentRow("categoryId",w.value)}))},d=O({show:!1,title:"标题",buttons:[{type:"danger",text:"确定",click:t=>{m()}}]}),_=v({}),D={categoryName:[{required:!0,message:"请输入分类名称"}]},R=v(),u=(t,o)=>{d.show=!0,U(()=>{R.value.resetFields(),t=="add"?(d.title="新增分类",_.value={}):t=="update"&&(d.title="编辑分类",_.value=JSON.parse(JSON.stringify(o)))})},m=()=>{R.value.validate(async t=>{if(!t)return;let o={};Object.assign(o,_.value),await f.Request({url:h.saveCategory,params:o})&&(d.show=!1,f.Message.success("保存成功"),B())})},s=t=>{f.Confirm(`你确定要删除${t.categoryName}`,async()=>{await f.Request({url:h.delCategory,params:{categoryId:t.categoryId}})&&(B(),w.value=null)})},S=t=>{w.value=t.categoryId,k()},$=v([]),k=async()=>{let t=await f.Request({url:h.getSpecialInfo,params:{categoryId:w.value,showType:"1"}});$.value=t.data},T={children:"children",label:"title",value:"blogId"},c=v(null),n=(t,o)=>{c.value.init(t,o)},N=()=>{k()},L=t=>{f.Confirm(`你确定要删除【${t.title}】`,async()=>{await f.Request({url:h.delBlog,params:{blogId:t.blogId}})&&k()})},z=async(t,o,j,X)=>{console.log(t,o,j);let C=null;j=="inner"?C=o:C=o.parent;const A=t.data.blogId,M=C.data.blogId,E=[];C.childNodes.forEach(P=>{E.push(P.data.blogId)});let J={blogId:A,pBlogId:M,blogIds:E.join(",")};await f.Request({url:h.updateSpecialBlogSort,params:J})&&k()},F=v(null),W=t=>{F.value.showDetail(t)};return(t,o)=>{const j=a("el-button"),X=a("Cover"),C=a("el-divider"),A=a("Table"),M=a("el-card"),E=a("el-col"),J=a("el-alert"),Y=a("el-tree"),P=a("el-row"),Z=a("el-input"),K=a("el-form-item"),te=a("CoverUpload"),oe=a("el-form"),le=a("Dialog");return p(),g("div",null,[e(j,{type:"danger",onClick:o[0]||(o[0]=r=>u("add"))},{default:l(()=>[ne("新增专题")]),_:1}),e(P,{gutter:10,style:{"margin-top":"10px"}},{default:l(()=>[e(E,{span:14},{default:l(()=>[e(M,{class:"box-card"},{header:l(()=>[ke]),default:l(()=>[e(A,{columns:I,showPagination:!0,dataSource:x,fetch:B,options:y,onRowClick:S,ref_key:"dataTableRef",ref:q},{cover:l(({row:r})=>[e(X,{cover:r.cover},null,8,["cover"])]),op:l(({row:r})=>[i("div",Ie,[i("a",{href:"javascript:void(0)",class:"a-link",onClick:V=>u("update",r)},"修改",8,Ce),e(C,{direction:"vertical"}),i("a",{href:"javascript:void(0)",class:"a-link",onClick:V=>s(r)},"删除",8,Se)])]),_:1},8,["dataSource"])]),_:1})]),_:1}),e(E,{span:10},{default:l(()=>[e(M,{class:"box-card"},{header:l(()=>[xe]),default:l(()=>[i("div",Be,[e(J,{title:"红色代表草稿绿色代表已发布、拖动文章修改排序",type:"info","show-icon":"",closable:!1})]),e(Y,{class:"tree-panel",ref:"refTree",data:$.value,defaultExpandAll:"","node-key":"blogId","expand-on-click-node":!1,props:T,"highlight-current":!0,draggable:"",onNodeDrop:z},{default:l(({data:r})=>[i("span",De,[i("span",Re,[r.status==0?(p(),g("span",$e,H(r.title),1)):(p(),g("span",Ve,H(r.title),1))]),i("span",qe,[r.blogId==="0"?(p(),g("a",{key:0,class:"a-link",href:"javascript:void(0)",onClick:V=>n("add",r)},"新增文章",8,Te)):(p(),g(re,{key:1},[i("a",{class:"a-link",href:"javascript:void(0)",onClick:V=>W(r)},"预览",8,je),e(C,{direction:"vertical"}),b.value.userId==r.userId?(p(),g("a",{key:0,class:"a-link",href:"javascript:void(0)",onClick:V=>n("edit",r)},"修改",8,Ee)):(p(),g("span",He,"--")),e(C,{direction:"vertical"}),b.value.userId==r.userId?(p(),g("a",{key:2,class:"a-link",href:"javascript:void(0)",onClick:V=>L(r)},"删除",8,Ue)):(p(),g("span",Ne,"--")),e(C,{direction:"vertical"}),i("a",{class:"a-link",href:"javascript:void(0)",onClick:V=>n("add",r)},"新增下级文章",8,Le)],64))])])]),_:1},8,["data"])]),_:1})]),_:1})]),_:1}),e(le,{show:d.show,title:d.title,buttons:d.buttons,width:"500px",onClose:o[4]||(o[4]=r=>d.show=!1)},{default:l(()=>[e(oe,{model:_.value,rules:D,ref_key:"formDataRef",ref:R,"label-width":"80px"},{default:l(()=>[e(K,{label:"名称",prop:"categoryName"},{default:l(()=>[e(Z,{placeholder:"请输入名称",modelValue:_.value.categoryName,"onUpdate:modelValue":o[1]||(o[1]=r=>_.value.categoryName=r)},null,8,["modelValue"])]),_:1}),e(K,{label:"封面",prop:"cover"},{default:l(()=>[e(te,{modelValue:_.value.cover,"onUpdate:modelValue":o[2]||(o[2]=r=>_.value.cover=r)},null,8,["modelValue"])]),_:1}),e(K,{label:"简介",prop:"categoryDesc"},{default:l(()=>[e(Z,{modelValue:_.value.categoryDesc,"onUpdate:modelValue":o[3]||(o[3]=r=>_.value.categoryDesc=r),type:"textarea",placeholder:"请输入简介",autosize:{minRows:4,maxRows:4}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","buttons"]),e(we,{ref_key:"blogEditRef",ref:c,onCallback:N},null,512),e(ye,{ref_key:"blogDetailRef",ref:F},null,512)])}}};export{Oe as default};
