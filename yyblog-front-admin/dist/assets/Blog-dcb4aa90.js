import{a as m,r as A,A as pe,B as ge,f as s,o as u,b as p,e as t,w as l,d,C,F as K,D as P,i as V,z as D,t as y,g as me,E as _e,G as te,j as Q,H as le,I as ve}from"./index-accd95a7.js";/* empty css                       */const fe={class:"title-input"},ye={style:{width:"100%"}},be={class:"allow-comment"},we=d("span",{class:"info"},"请先在评论设置里设置好相应参数，评论才会生效",-1),he={class:"tag-input-panel"},ke={class:"tag-list"},Ce={key:0,class:"info"},Ve={__name:"BlogEdit",setup(X,{expose:b,emit:x}){const{proxy:_}=Q(),i=window.innerHeight-60-20-30-50-10-50-10,k=window.innerHeight-60-20-30-50-100-50,I={loadAllCategory4Blog:"/category/loadAllCategory4Blog",saveBlog:"/blog/saveBlog",getUserInfo:"getUserInfo",getBlogDetail:"/blog/getBlogById",autoSave:"/blog/autoSaveBlog"};b({init:(r,a)=>{E(),B.show=!0,le(()=>{c.value.resetFields(),e.value={tag:[]},r==="add"?v():N(a.blogId)})}});const v=async()=>{let r=await _.Request({url:I.getUserInfo});r&&(e.value.editorType=r.data.editorType)},N=async r=>{let a=await _.Request({url:I.getBlogDetail,params:{blogId:r}});a&&(e.value=a.data,a.data.tag?e.value.tag=a.data.tag.split("|"):e.value.tag=[])};let g=m(null);const E=()=>{g.value=setInterval(()=>{O()},1e4)},S=()=>{g.value!==null&&(clearInterval(g.value),g.value=null)},O=async()=>{if(e.value.title==null||e.value.content==null||g.value==null||f.show)return;const r={};Object.assign(r,e.value);let a=await _.Request({url:I.autoSave,showLoading:!1,params:r});a&&(e.value.blogId=a.data)},B=A({show:!1,buttons:[{type:"danger",text:"确定",click:r=>{T()}}]}),F=()=>{B.show=!1,x("callback"),g.value!==null&&S()},c=m(null),e=m({tag:[]}),W=r=>{e.value.content=r},T=()=>{c.value.validate(async r=>{r&&(e.tag=e.tag==null?[]:e.tag,f.show=!0)})},U={title:[{required:!0,message:"请输入标题"}],content:[{required:!0,message:"请输入正文"}],categoryId:[{required:!0,message:"请选择博客分类"}],type:[{required:!0,message:"请选择博客类型"}],allowComment:[{required:!0,message:"请选择是否允许评论"}],reprintUrl:[{required:!0,message:"请输入原文地址"}]},f=A({show:!1,title:"博客设置",buttons:[{type:"danger",text:"确定",click:r=>{j()}}]}),q=m([]),z=async()=>{let r=await _.Request({url:I.loadAllCategory4Blog});q.value=r.data};pe(()=>{z()}),ge(()=>{S()});const G=r=>{e.value.tag.splice(r,1)},$=m(!1),J=()=>{$.value=!0},w=m(null),L=r=>{w.value!=null&&($.value=!1,e.value.tag.indexOf(w.value)==-1&&e.value.tag.push(w.value),w.value=void 0)},o=m(),j=()=>{o.value.validate(async r=>{if(!r)return;const a={};Object.assign(a,e.value),a.tag=a.tag.join("|"),await _.Request({url:I.saveBlog,params:a})&&(_.Message.success("保存博客成功"),f.show=!1,F())})};return(r,a)=>{const H=s("el-input"),h=s("el-form-item"),oe=s("EditorHtml"),ae=s("EditorMarkdown"),Y=s("el-form"),Z=s("el-option"),ne=s("el-select"),se=s("CoverUpload"),M=s("el-radio"),ee=s("el-radio-group"),ue=s("el-tag"),re=s("el-icon"),de=s("Dialog"),ie=s("Window");return u(),p("div",null,[t(ie,{show:B.show,buttons:B.buttons,onClose:F},{default:l(()=>[t(Y,{model:e.value,rules:U,ref_key:"blogFormRef",ref:c},{default:l(()=>[t(h,{prop:"title"},{default:l(()=>[d("div",fe,[t(H,{placeholder:"请输入博客标题",modelValue:e.value.title,"onUpdate:modelValue":a[0]||(a[0]=n=>e.value.title=n)},null,8,["modelValue"])])]),_:1}),t(h,{prop:"content"},{default:l(()=>[d("div",ye,[e.value.editorType==0?(u(),C(oe,{key:0,height:k,modelValue:e.value.content,"onUpdate:modelValue":a[1]||(a[1]=n=>e.value.content=n)},null,8,["modelValue"])):(u(),C(ae,{key:1,height:i,modelValue:e.value.markdownContent,"onUpdate:modelValue":a[2]||(a[2]=n=>e.value.markdownContent=n),onHtmlContent:W},null,8,["modelValue"]))])]),_:1})]),_:1},8,["model"]),t(de,{show:f.show,title:f.title,buttons:f.buttons,width:"800px",onClose:a[10]||(a[10]=n=>f.show=!1)},{default:l(()=>[t(Y,{model:e.value,rules:U,ref_key:"settingsFormRef",ref:o,"label-width":"80px",class:"blog-setting-form"},{default:l(()=>[t(h,{label:"博客分类",prop:"categoryId"},{default:l(()=>[t(ne,{modelValue:e.value.categoryId,"onUpdate:modelValue":a[3]||(a[3]=n=>e.value.categoryId=n),clearable:"",placeholder:"请选择分类",style:{width:"100%"}},{default:l(()=>[t(Z,{value:0,label:"全部分类"}),(u(!0),p(K,null,P(q.value,n=>(u(),C(Z,{value:n.categoryId,label:n.categoryName,key:n},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(h,{label:"封面",prop:"cover"},{default:l(()=>[t(se,{modelValue:e.value.cover,"onUpdate:modelValue":a[4]||(a[4]=n=>e.value.cover=n)},null,8,["modelValue"])]),_:1}),t(h,{label:"博客类型",prop:"type"},{default:l(()=>[t(ee,{modelValue:e.value.type,"onUpdate:modelValue":a[5]||(a[5]=n=>e.value.type=n)},{default:l(()=>[t(M,{label:0},{default:l(()=>[V("原创")]),_:1}),t(M,{label:1},{default:l(()=>[V("转载")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e.value.type==1?(u(),C(h,{key:0,label:"原文地址",prop:"reprintUrl"},{default:l(()=>[t(H,{modelValue:e.value.reprintUrl,"onUpdate:modelValue":a[6]||(a[6]=n=>e.value.reprintUrl=n),placeholder:"请输入原文地址"},null,8,["modelValue"])]),_:1})):D("",!0),t(h,{label:"评论",prop:"allowComment"},{default:l(()=>[d("div",be,[t(ee,{modelValue:e.value.allowComment,"onUpdate:modelValue":a[7]||(a[7]=n=>e.value.allowComment=n)},{default:l(()=>[t(M,{label:1},{default:l(()=>[V("允许")]),_:1}),t(M,{label:0},{default:l(()=>[V("不允许")]),_:1})]),_:1},8,["modelValue"]),we])]),_:1}),t(h,{label:"博客摘要",prop:"summary"},{default:l(()=>[t(H,{modelValue:e.value.summary,"onUpdate:modelValue":a[8]||(a[8]=n=>e.value.summary=n),type:"textarea",placeholder:"请输入摘要",autosize:{minRows:4,maxRows:4}},null,8,["modelValue"])]),_:1}),t(h,{label:"博客标签",prop:"categoryDesc"},{default:l(()=>[d("div",he,[d("div",ke,[(u(!0),p(K,null,P(e.value.tag,(n,ce)=>(u(),C(ue,{key:n,onClose:Le=>G(ce),closable:"",class:"tag-item"},{default:l(()=>[V(y(n),1)]),_:2},1032,["onClose"]))),128))]),e.value.tag.length==0?(u(),p("span",Ce,"添加标签更容易被搜索引擎收录")):D("",!0),d("span",null,[$.value?D("",!0):(u(),C(re,{key:0,class:"icon-add",size:25,onClick:J},{default:l(()=>[t(me(_e))]),_:1}))]),$.value?(u(),C(H,{key:1,class:"tag-input",modelValue:w.value,"onUpdate:modelValue":a[9]||(a[9]=n=>w.value=n),onBlur:L,onKeyup:te(L,["enter"])},null,8,["modelValue","onKeyup"])):D("",!0)])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","buttons"])]),_:1},8,["show","buttons"])])}}};const Ie={class:"my-title"},Be=["innerHTML"],Ue={__name:"BlogDetail",setup(X,{expose:b}){const{proxy:x}=Q(),_={getBlogDetail:"/blog/getBlogById"},i=A({show:!1,buttons:[{type:"danger",text:"确定",click:R=>{i.show=!1}}]}),k=m({});return b({showDetail:async R=>{i.show=!0;let v=await x.Request({url:_.getBlogDetail,params:{blogId:R}});v&&(k.value=v.data,le(()=>{document.querySelectorAll("pre code").forEach(g=>{ve.highlightBlock(g)})}))}}),(R,v)=>{const N=s("Window");return u(),p("div",null,[t(N,{show:i.show,buttons:i.buttons,showCancel:!1,onClose:v[0]||(v[0]=g=>i.show=!1)},{default:l(()=>[d("div",Ie,y(k.value.title),1),d("div",{innerHTML:k.value.content,class:"blog-detail"},null,8,Be)]),_:1},8,["show","buttons"])])}}},De={class:"top-panel"},xe={key:0},Re={key:1},Ne={key:0},$e={key:0,style:{color:"green"}},Se={key:1,style:{color:"red"}},Te={class:"op"},qe=["onClick"],He={key:1},Ee=["onClick"],Fe={key:3},ze=["onClick"],Ae={__name:"Blog",setup(X){const{proxy:b}=Q(),x=m(b.VueCookies.get("userInfo")||{}),_={loadCategory:"/category/loadAllCategory4Blog",loadDataList:"/blog/loadBlog",delBlog:"/blog/recoveryBlog"},i=A({}),k=m([]);(async()=>{let c=await b.Request({url:_.loadCategory});k.value=c.data})();const R=[{label:"封面",prop:"cover",width:80,scopedSlots:"cover"},{label:"文章信息",prop:"blogInfo",scopedSlots:"blogInfo"},{label:"编辑器",prop:"editorTypeName",width:100},{label:"类型",prop:"typeName",width:100,scopedSlots:"typeName"},{label:"评论",prop:"allowCommentTypeName",width:60},{label:"状态",prop:"status",width:80,scopedSlots:"statusName"},{label:"时间",prop:"time",width:250,scopedSlots:"time"},{label:"操作",prop:"op",width:180,scopedSlots:"op"}],v=m({}),N={extHeight:80},g=async()=>{let c={pageNo:v.value.pageNo,pageSize:v.value.pageSize};Object.assign(c,i);let e=await b.Request({url:_.loadDataList,params:c});e&&(v.value=e.data)},E=m(null),S=(c,e)=>{E.value.init(c,e)},O=c=>{b.Confirm(`你确定要删除【${c.title}】`,async()=>{await b.Request({url:_.delBlog,params:{blogId:c.blogId}})&&g()})},B=m(null),F=c=>{B.value.showDetail(c)};return(c,e)=>{const W=s("el-input"),T=s("el-form-item"),U=s("el-col"),f=s("el-option"),q=s("el-select"),z=s("el-button"),G=s("el-row"),$=s("el-form"),J=s("Cover"),w=s("el-divider"),L=s("Table");return u(),p(K,null,[d("div",De,[t($,{model:i,"label-width":"50px"},{default:l(()=>[t(G,null,{default:l(()=>[t(U,{span:5},{default:l(()=>[t(T,{label:"标题",prop:"titleFuzzy"},{default:l(()=>[t(W,{placeholder:"请输入名称",modelValue:i.titleFuzzy,"onUpdate:modelValue":e[0]||(e[0]=o=>i.titleFuzzy=o),clearable:"",onKeyup:te(g,["enter"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1}),t(U,{span:5},{default:l(()=>[t(T,{label:"状态",prop:"status"},{default:l(()=>[t(q,{modelValue:i.status,"onUpdate:modelValue":e[1]||(e[1]=o=>i.status=o),clearable:"",placeholder:"请选择状态",style:{width:"100%"}},{default:l(()=>[t(f,{value:0,label:"草稿"}),t(f,{value:1,label:"已发布"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(U,{span:5},{default:l(()=>[t(T,{label:"分类",prop:"categoryId"},{default:l(()=>[t(q,{modelValue:i.categoryId,"onUpdate:modelValue":e[2]||(e[2]=o=>i.categoryId=o),clearable:"",placeholder:"请选择分类",style:{width:"100%"}},{default:l(()=>[(u(!0),p(K,null,P(k.value,o=>(u(),C(f,{value:o.categoryId,label:o.categoryName,key:o},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(U,{span:2,style:{"padding-left":"10px"}},{default:l(()=>[t(z,{type:"danger",onClick:g},{default:l(()=>[V("搜索")]),_:1})]),_:1})]),_:1}),t(z,{type:"danger",onClick:e[3]||(e[3]=o=>S("add"))},{default:l(()=>[V("新增博客")]),_:1})]),_:1},8,["model"])]),t(L,{columns:R,showPagination:!0,dataSource:v.value,fetch:g,options:N},{cover:l(({row:o})=>[t(J,{cover:o.cover},null,8,["cover"])]),blogInfo:l(({row:o})=>[d("div",null,"标题："+y(o.title),1),d("div",null,"分类："+y(o.categoryName),1),d("div",null,"作者："+y(o.nickName),1)]),typeName:l(({row:o})=>[d("div",null,[V("类型："),o.type==0?(u(),p("span",xe,"原创")):D("",!0),o.type==1?(u(),p("span",Re,"转载")):D("",!0)]),o.type==1?(u(),p("div",Ne,"转载地址："+y(o.reprintUrl),1)):D("",!0)]),statusName:l(({row:o})=>[o.status==1?(u(),p("span",$e,y(o.statusName),1)):(u(),p("span",Se,y(o.statusName),1))]),time:l(({row:o})=>[d("div",null,"创建时间："+y(o.createTime),1),d("div",null,"更新时间："+y(o.lastUpdateTime),1)]),op:l(({row:o})=>[d("div",Te,[x.value.userId==o.userId?(u(),p("a",{key:0,href:"javascript:void(0)",class:"a-link",onClick:j=>S("update",o)},"修改",8,qe)):(u(),p("span",He,"--")),t(w,{direction:"vertical"}),x.value.userId==o.userId?(u(),p("a",{key:2,href:"javascript:void(0)",class:"a-link",onClick:j=>O(o)},"删除",8,Ee)):(u(),p("span",Fe,"--")),t(w,{direction:"vertical"}),d("a",{href:"javascript:void(0)",class:"a-link",onClick:j=>F(o.blogId)},"预览",8,ze)])]),_:1},8,["dataSource"]),t(Ve,{ref_key:"blogEditRef",ref:E,onCallback:g},null,512),t(Ue,{ref_key:"blogDetailRef",ref:B},null,512)],64)}}};export{Ae as default};
